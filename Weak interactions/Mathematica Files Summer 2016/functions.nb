(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    111013,       2648]
NotebookOptionsPosition[    110711,       2633]
NotebookOutlinePosition[    111068,       2649]
CellTagsIndexPosition[    111025,       2646]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", 
    RowBox[{"MAR", " ", 
     RowBox[{"functions", "."}]}], " ", "*)"}], "Subsection"], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "RowDelete", " ", "takes", " ", "a", " ", "matrix", " ", "and", " ", 
    "deletes", " ", "the", " ", "specified", " ", "rows"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RowDelete", "[", 
     RowBox[{"x_", ",", "entries_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"list", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"list", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"entries", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "entries", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Delete", "[", 
        RowBox[{"x", ",", "list"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "ColumnDelete", " ", "takes", " ", "a", " ", "matrix", " ", "and", " ", 
     "delete", " ", "the", " ", "specified", " ", "columns"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ColumnDelete", "[", 
     RowBox[{"x_", ",", "entries_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Transpose", "[", 
       RowBox[{"RowDelete", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", "x", "]"}], ",", "entries"}], "]"}], 
       "]"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "AddZeroToRow", " ", "adds", " ", "a", " ", "zero", " ", "to", " ", "a", 
     " ", "row", " ", "vector"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AddZeroToRow", "[", 
     RowBox[{"x_", ",", "j_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "l", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"l", "=", 
        RowBox[{"Length", "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{"x", ",", 
           RowBox[{"j", "-", "1"}]}], "]"}], ",", 
         RowBox[{"{", "0", "}"}], ",", 
         RowBox[{"Take", "[", 
          RowBox[{"x", ",", 
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{"l", "-", "j", "+", "1"}], ")"}]}]}], "]"}]}], "]"}]}]}],
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "AddZerosToRow", " ", "will", " ", "add", " ", "any", " ", "number", " ", 
     "of", " ", "zeros", " ", "to", " ", "a", " ", "row", " ", "vector"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AddZerosToRow", "[", 
     RowBox[{"x_", ",", "entries_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"y", ",", "list", ",", "i"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"y", "=", "x"}], ";", "\[IndentingNewLine]", 
       RowBox[{"list", "=", 
        RowBox[{"Sort", "[", "entries", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", 
          RowBox[{"Length", "[", "list", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"y", "=", 
          RowBox[{"AddZeroToRow", "[", 
           RowBox[{"y", ",", 
            RowBox[{"list", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "y"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Composite", " ", "constrained", " ", "and", " ", "unconstrained", " ", 
      "estimates", " ", "with", " ", 
      RowBox[{"covatiares", ".", " ", "I", ".", "e", "."}]}], ",", " ", 
     RowBox[{"the", " ", "most", " ", "general", " ", 
      RowBox[{"case", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MAR", "[", 
     RowBox[{"datasets_", ",", " ", "cov_", ",", " ", "constraints_"}], "]"}],
     ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "X", ",", "U", ",", "Y", ",", "Z", ",", "D", ",", "d0", ",", "p", ",", 
        "x0", ",", "u0", ",", "y0", ",", "one", ",", "popdata", ",", 
        "covdata", ",", "tanks", ",", "tankrow", ",", "index", ",", 
        "tempdata", ",", "c", ",", "j", ",", "k"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"datasets", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "cov"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"cov", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"Y", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{
                RowBox[{"datasets", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"datasets", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"y0", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{
                RowBox[{"datasets", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Y", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"Y", ",", "y0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"one", "=", 
           RowBox[{"{", 
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "X", "]"}]}], "}"}]}], "]"}], "}"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Z", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Join", "[", 
             RowBox[{"one", ",", 
              RowBox[{"Transpose", "[", "X", "]"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"D", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "p"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"c", "=", 
              RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", "=", "1"}], ",", 
               RowBox[{"j", "\[LessEqual]", "p"}], ",", 
               RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{"c", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"constraints", ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "j"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", "j", "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "]"}]}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"d0", "=", 
              RowBox[{"{", 
               RowBox[{"AddZerosToRow", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"Y", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "k"}], "]"}], "]"}], "}"}], ".", 
                   RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1"}]}], "]"}], ".", 
                   RowBox[{"Inverse", "[", 
                    RowBox[{
                    RowBox[{"Transpose", "[", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1"}]}], "]"}], "]"}], ".", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1"}]}], "]"}]}], "]"}]}], "]"}], ",", 
                 RowBox[{"c", "+", "1"}]}], "]"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"D", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"D", ",", "d0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "D"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"Y", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"U", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tempdata", "=", 
              RowBox[{"datasets", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"x0", "=", 
              RowBox[{"tempdata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{
                  RowBox[{"cov", "+", "1"}], ";;", 
                  RowBox[{"cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"x0", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{"x0", ",", 
                RowBox[{"Length", "[", "x0", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"u0", "=", 
              RowBox[{"tempdata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"1", ";;", "cov"}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"u0", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{"u0", ",", 
                RowBox[{"Length", "[", "u0", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"y0", "=", 
              RowBox[{"tempdata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{
                  RowBox[{"cov", "+", "1"}], ";;", 
                  RowBox[{"cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"y0", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{"y0", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"U", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"U", ",", "u0"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Y", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"Y", ",", "y0"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"one", "=", 
           RowBox[{"{", 
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "X", "]"}]}], "}"}]}], "]"}], "}"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Z", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Join", "[", 
             RowBox[{"one", ",", 
              RowBox[{"Transpose", "[", "U", "]"}], ",", 
              RowBox[{"Transpose", "[", "X", "]"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"D", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "p"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"c", "=", 
              RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", "=", "1"}], ",", 
               RowBox[{"j", "\[LessEqual]", "p"}], ",", 
               RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{"c", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"constraints", ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "j"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", "j", "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "]"}]}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"d0", "=", 
              RowBox[{"{", 
               RowBox[{"AddZerosToRow", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"Y", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "k"}], "]"}], "]"}], "}"}], ".", 
                   RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}], ".", 
                   RowBox[{"Inverse", "[", 
                    RowBox[{
                    RowBox[{"Transpose", "[", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}], "]"}], ".", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}]}], "]"}]}], 
                  "]"}], ",", 
                 RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"D", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"D", ",", "d0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "D"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "MAR", " ", "process", " ", "with", " ", "different", " ", "time", " ", 
      "lags"}], ",", " ", 
     RowBox[{"set", " ", "by", " ", "n"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MARnstep", "[", 
     RowBox[{
     "datasets_", ",", " ", "cov_", ",", " ", "constraints_", ",", "n_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "X", ",", "U", ",", "Y", ",", "Z", ",", "D", ",", "d0", ",", "p", ",", 
        "x0", ",", "u0", ",", "y0", ",", "one", ",", "popdata", ",", 
        "covdata", ",", "tanks", ",", "tankrow", ",", "index", ",", 
        "tempdata", ",", "c", ",", "j", ",", "k"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"datasets", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "cov"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"cov", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"Y", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{
                RowBox[{"datasets", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"datasets", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"z", "=", "1"}], ",", 
               RowBox[{"z", "\[LessEqual]", 
                RowBox[{"n", "-", "1"}]}], ",", 
               RowBox[{"z", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"x0", "=", 
                 RowBox[{"Delete", "[", 
                  RowBox[{"x0", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"y0", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{
                RowBox[{"datasets", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"z", "=", "1"}], ",", 
               RowBox[{"z", "\[LessEqual]", 
                RowBox[{"n", "-", "1"}]}], ",", 
               RowBox[{"z", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"y0", "=", 
                 RowBox[{"Delete", "[", 
                  RowBox[{"y0", ",", "1"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Y", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"Y", ",", "y0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"one", "=", 
           RowBox[{"{", 
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "X", "]"}]}], "}"}]}], "]"}], "}"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Z", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Join", "[", 
             RowBox[{"one", ",", 
              RowBox[{"Transpose", "[", "X", "]"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"D", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "p"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"c", "=", 
              RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", "=", "1"}], ",", 
               RowBox[{"j", "\[LessEqual]", "p"}], ",", 
               RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{"c", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"constraints", ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "j"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", "j", "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "]"}]}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"d0", "=", 
              RowBox[{"{", 
               RowBox[{"AddZerosToRow", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"Y", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "k"}], "]"}], "]"}], "}"}], ".", 
                   RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1"}]}], "]"}], ".", 
                   RowBox[{"Inverse", "[", 
                    RowBox[{
                    RowBox[{"Transpose", "[", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1"}]}], "]"}], "]"}], ".", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1"}]}], "]"}]}], "]"}]}], "]"}], ",", 
                 RowBox[{"c", "+", "1"}]}], "]"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"D", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"D", ",", "d0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "D"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"Y", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"U", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"tempdata", "=", 
              RowBox[{"datasets", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"x0", "=", 
              RowBox[{"tempdata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{
                  RowBox[{"cov", "+", "1"}], ";;", 
                  RowBox[{"cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"z", "=", "1"}], ",", 
               RowBox[{"z", "\[LessEqual]", "n"}], ",", 
               RowBox[{"z", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"x0", "=", 
                 RowBox[{"Delete", "[", 
                  RowBox[{"x0", ",", 
                   RowBox[{"Length", "[", "x0", "]"}]}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"u0", "=", 
              RowBox[{"tempdata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"1", ";;", "cov"}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"z", "=", "1"}], ",", 
               RowBox[{"z", "\[LessEqual]", "n"}], ",", 
               RowBox[{"z", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"u0", "=", 
                 RowBox[{"Delete", "[", 
                  RowBox[{"u0", ",", 
                   RowBox[{"Length", "[", "u0", "]"}]}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"y0", "=", 
              RowBox[{"tempdata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{
                  RowBox[{"cov", "+", "1"}], ";;", 
                  RowBox[{"cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"z", "=", "1"}], ",", 
               RowBox[{"z", "\[LessEqual]", "n"}], ",", 
               RowBox[{"z", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"y0", "=", 
                 RowBox[{"Delete", "[", 
                  RowBox[{"y0", ",", "1"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"U", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"U", ",", "u0"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Y", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"Y", ",", "y0"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"one", "=", 
           RowBox[{"{", 
            RowBox[{"Table", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "X", "]"}]}], "}"}]}], "]"}], "}"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Z", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Join", "[", 
             RowBox[{"one", ",", 
              RowBox[{"Transpose", "[", "U", "]"}], ",", 
              RowBox[{"Transpose", "[", "X", "]"}]}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"D", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"k", "=", "1"}], ",", 
            RowBox[{"k", "\[LessEqual]", "p"}], ",", 
            RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"c", "=", 
              RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", "=", "1"}], ",", 
               RowBox[{"j", "\[LessEqual]", "p"}], ",", 
               RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{"c", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"c", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"constraints", ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "j"}], "}"}]}], "]"}], ",", 
                    RowBox[{"{", "j", "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "]"}]}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"d0", "=", 
              RowBox[{"{", 
               RowBox[{"AddZerosToRow", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"Y", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "k"}], "]"}], "]"}], "}"}], ".", 
                   RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}], ".", 
                   RowBox[{"Inverse", "[", 
                    RowBox[{
                    RowBox[{"Transpose", "[", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}], "]"}], ".", 
                    RowBox[{"ColumnDelete", "[", 
                    RowBox[{"Z", ",", 
                    RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}]}], "]"}]}], 
                  "]"}], ",", 
                 RowBox[{"c", "+", "1", "+", "cov"}]}], "]"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"D", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"D", ",", "d0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "D"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   StyleBox[
    RowBox[{"(*", 
     RowBox[{
     "Process", " ", "raw", " ", "data", " ", "after", " ", "it", " ", "has", 
      " ", "been", " ", 
      RowBox[{"imported", "."}]}], "*)"}], "Subsubsection"], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ProcessData", "[", 
     RowBox[{"raw_", ",", "cov_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "rawdata", ",", "p", ",", "tankrow", ",", "tanks", ",", "purepopdata", 
        ",", "logpopdata", ",", "covdata", ",", "logcovdata", ",", 
        "processeddata", ",", "index", ",", "compdataset", ",", "i", ",", 
        "i0", ",", "j", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rawdata", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"raw", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"rawdata", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "cov", "-", "1"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"tankrow", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{
          RowBox[{"raw", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "extracts", " ", "the", " ", "column", " ", "of", " ", "tank", " ", 
         "labels", " ", "as", " ", "a", " ", "row", " ", 
         RowBox[{"vector", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"tanks", "=", 
        RowBox[{"DeleteDuplicates", "[", "tankrow", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Just", " ", "getting", " ", "a", " ", "list", " ", "of", " ", "tank",
          " ", "labels"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"purepopdata", "=", 
        RowBox[{"ColumnDelete", "[", 
         RowBox[{"rawdata", ",", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", "cov"}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{"purepopdata", "=", 
          RowBox[{"ColumnDelete", "[", 
           RowBox[{"purepopdata", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"logpopdata", "=", 
        RowBox[{"Log", "[", "purepopdata", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"cov", "\[Equal]", "0"}], ",", 
         RowBox[{"logcovdata", "=", 
          RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"covdata", "=", 
           RowBox[{"ColumnDelete", "[", 
            RowBox[{"rawdata", ",", 
             RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "\[LessEqual]", "p"}], ",", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"covdata", "=", 
              RowBox[{"ColumnDelete", "[", 
               RowBox[{"covdata", ",", 
                RowBox[{"{", 
                 RowBox[{"Length", "[", 
                  RowBox[{"covdata", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "}"}]}], "]"}]}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"logcovdata", "=", 
           RowBox[{"Log", "[", "covdata", "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"processeddata", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"cov", "\[Equal]", "0"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "tankrow", "}"}], ",", 
             RowBox[{"Transpose", "[", "logpopdata", "]"}]}], "]"}], "]"}], 
          ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "tankrow", "}"}], ",", 
             RowBox[{"Transpose", "[", "logcovdata", "]"}], ",", 
             RowBox[{"Transpose", "[", "logpopdata", "]"}]}], "]"}], "]"}]}], 
         "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Join", " ", "log", " ", "transformed", " ", "values", " ", "back", 
         " ", "up", " ", "with", " ", "tank", " ", "labels"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Below", " ", "we", " ", "extract", " ", "tank", " ", "specific", " ",
          "processed", " ", "data", " ", "and", " ", "label", " ", "it", " ", 
         "by", " ", "the", " ", "tank", " ", 
         RowBox[{"label", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", 
          RowBox[{"Length", "[", "tanks", "]"}]}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"index", "=", 
           RowBox[{"tanks", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"data", "[", "index", "]"}], "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "\[LessEqual]", 
             RowBox[{"Length", "[", "processeddata", "]"}]}], ",", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"i0", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"processeddata", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}], "\[Equal]", 
                 "index"}], ",", 
                RowBox[{"{", 
                 RowBox[{"processeddata", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
                RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"data", "[", "index", "]"}], "=", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"data", "[", "index", "]"}], ",", "i0"}], "]"}]}]}]}],
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"data", "[", "index", "]"}], "=", 
           RowBox[{"ColumnDelete", "[", 
            RowBox[{
             RowBox[{"data", "[", "index", "]"}], ",", 
             RowBox[{"{", "1", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"compdataset", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", 
          RowBox[{"Length", "[", "tanks", "]"}]}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"index", "=", 
           RowBox[{"tanks", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"compdataset", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"compdataset", ",", 
             RowBox[{"{", 
              RowBox[{"data", "[", "index", "]"}], "}"}]}], "]"}]}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "compdataset"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   StyleBox[
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Sensitivity", "/", "variance"}], " ", "measures"}], "*)"}], 
    "Subsubsection"], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"B", "[", "D_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p", ",", "x", ",", "B"}], "}"}], ",", 
      RowBox[{"(*", 
       RowBox[{"extract", " ", "B", " ", "matrix"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"x", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"D", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"D", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{"x", "-", "p", "+", "1"}], ";;", "x"}]}], "]"}], 
         "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Cmat", "[", 
     RowBox[{"D_", ",", "covs_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "cmat", "}"}], ",", 
      RowBox[{"(*", 
       RowBox[{"extract", " ", "C", " ", "matrix"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"cmat", "=", 
       RowBox[{"D", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"2", ";;", 
           RowBox[{"covs", "+", "1"}]}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Sens", "[", "D_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p", ",", "b", ",", "det", ",", "eig"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b", "=", 
        RowBox[{"B", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"det", "=", 
        RowBox[{"Det", "[", "b", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eig", "=", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"Eigenvalues", "[", "b", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"det", "^", "2"}], ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "p"}], ")"}]}], ",", "eig", ",", 
         RowBox[{"1", "/", 
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"eig", "^", "2"}]}], ")"}]}], ",", "det"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   StyleBox["\[IndentingNewLine]", "Subsubsection"], 
   RowBox[{
    RowBox[{"CovMat", "[", 
     RowBox[{"datasets_", ",", "cov_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"X", ",", "m", ",", "covmat", ",", "i"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"X", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"datasets", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", "cov"}], ",", 
         RowBox[{"i", "++"}], ",", 
         RowBox[{"X", "=", 
          RowBox[{"ColumnDelete", "[", 
           RowBox[{"X", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m", "=", 
        RowBox[{"Mean", "[", "X", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"covmat", "=", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"X", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "-", "m"}], "}"}], "]"}], ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"X", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "-", "m"}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "X", "]"}]}], "}"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Length", "[", "X", "]"}], "-", "1"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", "covmat"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PC", "[", 
     RowBox[{"datasets_", ",", "cov_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "covmat", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"covmat", "=", 
        RowBox[{"CovMat", "[", 
         RowBox[{"datasets", ",", "cov"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Eigenvalues", "[", "covmat", "]"}]}]}], "\[IndentingNewLine]",
      "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"expCV", "[", 
     RowBox[{"datasets_", ",", "cov_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p", ",", "X", ",", "x0", ",", "j"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"datasets", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "cov"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"cov", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{"Exp", "[", 
               RowBox[{"datasets", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"datasets", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", 
                  RowBox[{
                   RowBox[{"cov", "+", "1"}], ";;", 
                   RowBox[{"cov", "+", "p"}]}]}], "]"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{"StandardDeviation", "[", "X", "]"}], "/", 
         RowBox[{"Mean", "[", "X", "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"expVAR", "[", 
     RowBox[{"datasets_", ",", "cov_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p", ",", "X", ",", "x0", ",", "j"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"datasets", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "-", "cov"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"cov", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{"Exp", "[", 
               RowBox[{"datasets", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"X", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"Length", "[", "datasets", "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"datasets", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", 
                  RowBox[{
                   RowBox[{"cov", "+", "1"}], ";;", 
                   RowBox[{"cov", "+", "p"}]}]}], "]"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X", ",", "x0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
           "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{"Variance", "[", "X", "]"}], "/", 
         RowBox[{"Mean", "[", "X", "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   StyleBox[
    RowBox[{"(*", 
     RowBox[{"Relative", " ", "Interaction", " ", "Strengths"}], "*)"}], 
    "Subsubsection"], 
   StyleBox["\[IndentingNewLine]", "Subsubsection"], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RelInt", "[", "B_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "p", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"B", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], "-", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"B", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "i"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "p"}], "}"}]}], "]"}]}], ")"}], "/", 
         RowBox[{"Total", "[", 
          RowBox[{"B", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RIS", "[", "D_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "p", ",", "cov", ",", "B", ",", "erow", ",", "e1", ",", "e2", ",", 
        "e3", ",", "e4", ",", "rel"}], "}"}], ",", " ", 
      RowBox[{"(*", 
       RowBox[{"row", ":", " ", 
        RowBox[{"top", " ", "down", " ", "control"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cov", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"D", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "p", "-", "1"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"D", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{"2", "+", "cov"}], ";;", 
            RowBox[{"1", "+", "cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"erow", "=", 
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "second", " ", "to", " ", "last", " ", "row", " ", 
         "in", " ", "B", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"e1", "=", 
        RowBox[{"Abs", "[", 
         RowBox[{"Delete", "[", 
          RowBox[{"erow", ",", 
           RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Delete", " ", "second", " ", "to", " ", "last", " ", "entry", " ", 
         "in", " ", "erow", " ", 
         RowBox[{"(", "diagonal", ")"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"e2", "=", 
        RowBox[{"Sort", "[", "e1", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"sorts", " ", "small", " ", "to", " ", "large"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"e3", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"e2", ",", 
          RowBox[{"-", "1"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"delete", " ", "largest", " ", "value"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"e4", "=", 
        RowBox[{"Mean", "[", "e3", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"average", " ", "of", " ", "smaller", " ", "values"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"rel", "=", 
        RowBox[{"e4", "/", 
         RowBox[{"Max", "[", "e1", "]"}]}]}]}]}], 
     RowBox[{"(*", 
      RowBox[{"average", "/", "largest"}], "*)"}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RISd", "[", "D_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "p", ",", "cov", ",", "B", ",", "erow", ",", "e2", ",", "e3", ",", 
        "e4", ",", "rel"}], "}"}], ",", " ", 
      RowBox[{"(*", 
       RowBox[{"row", ":", " ", 
        RowBox[{
        "top", " ", "down", " ", "control", " ", "with", " ", "diagonal", " ",
          "entry"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cov", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"D", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "p", "-", "1"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"D", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{"2", "+", "cov"}], ";;", 
            RowBox[{"1", "+", "cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"erow", "=", 
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "second", " ", "to", " ", "last", " ", "row", " ", 
         "in", " ", "B", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"e2", "=", 
        RowBox[{"Abs", "[", 
         RowBox[{"Sort", "[", "erow", "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "sorts", " ", "small", " ", "to", " ", "large", " ", "absolute", " ", 
         "value"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"e3", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"e2", ",", 
          RowBox[{"-", "1"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"delete", " ", "largest", " ", "value"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"e4", "=", 
        RowBox[{"Mean", "[", "e3", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"average", " ", "of", " ", "smaller", " ", "values"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"rel", "=", 
        RowBox[{"e4", "/", 
         RowBox[{"Max", "[", "e2", "]"}]}]}]}]}], 
     RowBox[{"(*", 
      RowBox[{"average", "/", "largest"}], "*)"}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bRIS", "[", "D_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "p", ",", "cov", ",", "B", ",", "ecol", ",", "e1", ",", "e2", ",", 
        "e3", ",", "e4", ",", "rel"}], "}"}], ",", " ", 
      RowBox[{"(*", 
       RowBox[{"column", ":", " ", 
        RowBox[{"bottom", " ", "up", " ", "control"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cov", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"D", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "p", "-", "1"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"D", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{"2", "+", "cov"}], ";;", 
            RowBox[{"1", "+", "cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ecol", "=", 
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "second", " ", "to", " ", "last", " ", "column", " ", 
         "in", " ", "B", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"e1", "=", 
        RowBox[{"Abs", "[", 
         RowBox[{"Delete", "[", 
          RowBox[{"ecol", ",", 
           RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Delete", " ", "second", " ", "to", " ", "last", " ", "entry", " ", 
         "in", " ", "erow", " ", 
         RowBox[{"(", "diagonal", ")"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"e2", "=", 
        RowBox[{"Sort", "[", "e1", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"sorts", " ", "small", " ", "to", " ", "large"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"e3", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"e2", ",", 
          RowBox[{"-", "1"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"delete", " ", "largest", " ", "value"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"e4", "=", 
        RowBox[{"Mean", "[", "e3", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"average", " ", "of", " ", "smaller", " ", "values"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"rel", "=", 
        RowBox[{"e4", "/", 
         RowBox[{"Max", "[", "e1", "]"}]}]}]}]}], 
     RowBox[{"(*", 
      RowBox[{"average", "/", "largest"}], "*)"}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bRISd", "[", "D_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "p", ",", "cov", ",", "B", ",", "ecol", ",", "e2", ",", "e3", ",", 
        "e4", ",", "rel"}], "}"}], ",", " ", 
      RowBox[{"(*", 
       RowBox[{"column", ":", " ", 
        RowBox[{
        "bottom", " ", "up", " ", "control", " ", "with", " ", "diagonal", 
         " ", "entry"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cov", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"D", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "p", "-", "1"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"D", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{"2", "+", "cov"}], ";;", 
            RowBox[{"1", "+", "cov", "+", "p"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ecol", "=", 
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
        "Extract", " ", "second", " ", "to", " ", "last", " ", "column", " ", 
         "in", " ", "B", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"e2", "=", 
        RowBox[{"Abs", "[", 
         RowBox[{"Sort", "[", "ecol", "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"sorts", " ", "small", " ", "to", " ", "large"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"e3", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"e2", ",", 
          RowBox[{"-", "1"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"delete", " ", "largest", " ", "value"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"e4", "=", 
        RowBox[{"Mean", "[", "e3", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"average", " ", "of", " ", "smaller", " ", "values"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"rel", "=", 
        RowBox[{"e4", "/", 
         RowBox[{"Max", "[", "e2", "]"}]}]}]}]}], 
     RowBox[{"(*", 
      RowBox[{"average", "/", "largest"}], "*)"}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   StyleBox[
    RowBox[{"(*", 
     RowBox[{"Data", " ", "generation"}], "*)"}], "Subsubsection"], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Old", " ", "data", " ", "generation", " ", "functions"}], " ", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"GenSig", "[", 
      RowBox[{"p_", ",", "r_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "sig", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"sig", "=", 
           RowBox[{"Round", "[", 
            RowBox[{
             RowBox[{"Covariance", "[", 
              RowBox[{"RandomVariate", "[", 
               RowBox[{
                RowBox[{"NormalDistribution", "[", 
                 RowBox[{"0", ",", "r"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"p", ",", "p"}], "}"}]}], "]"}], "]"}], ",", 
             ".001"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"Eigenvalues", "[", "sig", "]"}], "]"}], "\[LessEqual]",
              "0"}], ",", "\[IndentingNewLine]", 
            RowBox[{"sig", "=", 
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Covariance", "[", 
                RowBox[{"RandomVariate", "[", 
                 RowBox[{
                  RowBox[{"NormalDistribution", "[", 
                   RowBox[{"0", ",", "r"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "p"}], "}"}]}], "]"}], "]"}], ",", 
               ".001"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          "sig"}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"GenPreB", "[", "p_", "]"}]}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "diags", ",", "preB", ",", "B", ",", "r", ",", "s", ",", "b", ",", 
            "i"}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"r", "=", 
            RowBox[{"RandomVariate", "[", 
             RowBox[{"UniformDistribution", "[", "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"s", "=", 
            RowBox[{"RandomVariate", "[", 
             RowBox[{"UniformDistribution", "[", "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"diags", "=", 
            RowBox[{"RandomVariate", "[", 
             RowBox[{
              RowBox[{"UniformDistribution", "[", 
               RowBox[{"{", 
                RowBox[{"0", ",", "r"}], "}"}], "]"}], ",", "p"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"preB", "=", 
            RowBox[{"RandomVariate", "[", 
             RowBox[{
              RowBox[{"NormalDistribution", "[", 
               RowBox[{"0", ",", "s"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", ",", 
                RowBox[{"p", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"B", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "\[LessEqual]", "p"}], ",", 
             RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"b", "=", 
               RowBox[{"Insert", "[", 
                RowBox[{
                 RowBox[{"preB", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"diags", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", "i"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"B", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"B", ",", 
                 RowBox[{"{", "b", "}"}]}], "]"}]}]}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "B"}]}],
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"GenPreBTest", "[", "p_", "]"}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "diags", ",", "preB", ",", "B", ",", "r", ",", "s", ",", "b", ",",
              "i"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"r", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"UniformDistribution", "[", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"s", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"UniformDistribution", "[", 
               RowBox[{"{", 
                RowBox[{"0", ",", "r"}], "}"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"diags", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{
               RowBox[{"UniformDistribution", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "r"}], "}"}], "]"}], ",", "p"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"preB", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{
               RowBox[{"NormalDistribution", "[", 
                RowBox[{"0", ",", "s"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", 
                 RowBox[{"p", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"B", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"i", "=", "1"}], ",", 
              RowBox[{"i", "\[LessEqual]", "p"}], ",", 
              RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"b", "=", 
                RowBox[{"Insert", "[", 
                 RowBox[{
                  RowBox[{"preB", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"diags", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "i"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"B", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"B", ",", 
                  RowBox[{"{", "b", "}"}]}], "]"}]}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "B"}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"GenBTest", "[", "p_", "]"}]}], ":=", 
        RowBox[{
         RowBox[{
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", "B", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"B", "=", 
              RowBox[{"GenPreBTest", "[", "p", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"While", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{"Abs", "[", 
                  RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}], 
                "\[GreaterEqual]", "1"}], ",", 
               RowBox[{"B", "=", 
                RowBox[{"GenPreBTest", "[", "p", "]"}]}]}], "]"}], ";", 
             "\[IndentingNewLine]", "B"}]}], "\[IndentingNewLine]", "]"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"GenB", "[", "p_", "]"}]}], ":=", 
         RowBox[{
          RowBox[{
           RowBox[{"Module", "[", 
            RowBox[{
             RowBox[{"{", "B", "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"B", "=", 
               RowBox[{"GenPreB", "[", "p", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"While", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Max", "[", 
                  RowBox[{"Abs", "[", 
                   RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}], 
                 "\[GreaterEqual]", "1"}], ",", 
                RowBox[{"B", "=", 
                 RowBox[{"GenPreB", "[", "p", "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", "B"}]}], "\[IndentingNewLine]", "]"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"GenBRange", "[", 
            RowBox[{"p_", ",", "range_"}], "]"}]}], ":=", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"B", ",", "a", ",", "b"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"a", "=", 
              RowBox[{"Min", "[", "range", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"b", "=", 
              RowBox[{"Max", "[", "range", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"B", "=", 
              RowBox[{"GenB", "[", "p", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"While", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Max", "[", 
                  RowBox[{"Abs", "[", 
                   RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}], 
                 "\[LessEqual]", "a"}], "||", 
                RowBox[{
                 RowBox[{"Max", "[", 
                  RowBox[{"Abs", "[", 
                   RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}], 
                 "\[GreaterEqual]", "b"}]}], ",", 
               RowBox[{"B", "=", 
                RowBox[{"GenB", "[", "p", "]"}]}]}], "]"}], ";", 
             "\[IndentingNewLine]", "B"}]}], "\[IndentingNewLine]", 
           "]"}]}]}]}]}]}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   StyleBox["\[IndentingNewLine]", "Subsubsection"], 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "one", " ", "potential", " ", "B", " ", "matrix", " ", 
     "of", " ", "size", " ", "pxp", " ", "without", " ", "evaluating", " ", 
     "its", " ", "stability", "\[IndentingNewLine]", "These", " ", "values", 
     " ", "are", " ", "based", " ", "on", " ", "the", " ", "statistics", " ", 
     "of", " ", "the", " ", "averaged", " ", "B", " ", "matrices", " ", 
     "from", " ", "our", " ", "real", " ", "data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenPreBAveraged", "[", "p_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"diags", ",", "preB", ",", "B", ",", "b", ",", "i"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"diags", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", "\[InvisibleSpace]", 
           RowBox[{"0.39893", ",", "0.21646"}], "]"}], ",", "p"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"preB", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{
            RowBox[{"-", "0.03623"}], ",", 
            "\[InvisibleSpace] \[InvisibleSpace]", "0.23747"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"p", ",", 
            RowBox[{"p", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", "p"}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"b", "=", 
           RowBox[{"Insert", "[", 
            RowBox[{
             RowBox[{"preB", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"diags", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "i"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"B", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"B", ",", 
             RowBox[{"{", "b", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "B"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "B", " ", "matrices", " ", "until", " ", "a", " ", 
     "stable", " ", "B", " ", "matrix", " ", "is", " ", "produced"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenBAveraged", "[", "p_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "B", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"B", "=", 
        RowBox[{"GenPreBAveraged", "[", "p", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"Abs", "[", 
            RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}], 
          "\[GreaterEqual]", "1"}], ",", 
         RowBox[{"B", "=", 
          RowBox[{"GenPreBAveraged", "[", "p", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "B"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generates", " ", "a", " ", "potential", " ", "B", " ", "matrix", " ", 
     "uses", " ", "more", " ", "precise", " ", "statistics", " ", "based", 
     " ", "on", " ", "the", " ", "original", " ", "B", " ", "matrices"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenPreBNew", "[", "p_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "botEd", ",", "botIned", ",", "topEd", ",", "topIned", ",", 
        "algaeDiag", ",", "speciesDiag", ",", "algaeComp", ",", "speciesComp",
         ",", "B", ",", "b", ",", "i", ",", "j"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"botEd", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{
            RowBox[{"-", "0.167"}], ",", "0.225"}], "]"}], ",", 
          RowBox[{"p", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"botIned", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{
            RowBox[{"-", "0.162"}], ",", "0.224"}], "]"}], ",", 
          RowBox[{"p", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"topEd", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{
            RowBox[{"-", "0.162"}], ",", "0.224"}], "]"}], ",", 
          RowBox[{"p", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"topIned", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{
            RowBox[{"-", "0.159"}], ",", "0.227"}], "]"}], ",", 
          RowBox[{"p", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"algaeDiag", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{"0.509", ",", "0.224"}], "]"}], ",", "2"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"speciesDiag", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{"0.658", ",", "0.132"}], "]"}], ",", 
          RowBox[{"p", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"algaeComp", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{"0.092", ",", "0.232"}], "]"}], ",", "2"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"p", ">", "3"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"speciesComp", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"NormalDistribution", "[", 
              RowBox[{
               RowBox[{"-", "0.056"}], ",", "0.131"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"p", "-", "2"}], ",", 
               RowBox[{"p", "-", "2"}]}], "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"B", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"q", ",", "1", ",", "p"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"r", ",", "1", ",", "p"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", 
          RowBox[{"p", "-", "2"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"B", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "i"}], "]"}], "]"}], "=", 
           RowBox[{"speciesDiag", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", 
             RowBox[{"p", "-", "2"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"i", "\[NotEqual]", "j"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"B", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
                 RowBox[{"speciesComp", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"i", "=", 
        RowBox[{"p", "-", "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", 
          RowBox[{"p", "-", "2"}]}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"B", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{"botEd", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"B", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"i", "+", "1"}], ",", "j"}], "]"}], "]"}], "=", 
           RowBox[{"botIned", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"B", "[", 
            RowBox[{"[", 
             RowBox[{"j", ",", "i"}], "]"}], "]"}], "=", 
           RowBox[{"topEd", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"B", "[", 
            RowBox[{"[", 
             RowBox[{"j", ",", 
              RowBox[{"i", "+", "1"}]}], "]"}], "]"}], "=", 
           RowBox[{"topIned", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"p", "-", "1"}], ",", 
           RowBox[{"p", "-", "1"}]}], "]"}], "]"}], "=", 
        RowBox[{"algaeDiag", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{"p", ",", "p"}], "]"}], "]"}], "=", 
        RowBox[{"algaeDiag", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"p", "-", "1"}], ",", "p"}], "]"}], "]"}], "=", 
        RowBox[{"algaeComp", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"B", "[", 
         RowBox[{"[", 
          RowBox[{"p", ",", 
           RowBox[{"p", "-", "1"}]}], "]"}], "]"}], "=", 
        RowBox[{"algaeComp", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "B"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "B", " ", "matrices", " ", "until", " ", "a", " ", 
     "stable", " ", "B", " ", "matrix", " ", "is", " ", "produced"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenBNew", "[", "p_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "B", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"B", "=", 
        RowBox[{"GenPreBNew", "[", "p", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"Abs", "[", 
            RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}], 
          "\[GreaterEqual]", "1"}], ",", 
         RowBox[{"B", "=", 
          RowBox[{"GenPreBNew", "[", "p", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "B"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "a", " ", "C", " ", "matrix", " ", "for", " ", "a", " ", 
     "system", " ", "with", " ", "p", " ", "species", " ", "and", " ", "d", 
     " ", "covariates", "\[IndentingNewLine]", "These", " ", "values", " ", 
     "reflect", " ", "the", " ", "statistics", " ", "of", " ", "the", " ", 
     "C", " ", "matrices", " ", "from", " ", "our", " ", "real", " ", 
     "data"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenC", "[", 
     RowBox[{"p_", ",", "d_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "cmat", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"cmat", "=", 
       RowBox[{"RandomVariate", "[", 
        RowBox[{
         RowBox[{"NormalDistribution", "[", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "d"}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "one", " ", "potential", " ", "Sigma", " ", "matrix", 
     " ", "for", " ", "a", " ", "system", " ", "with", " ", "p", " ", 
     "species", " ", "without", " ", "evaluating", " ", "if", " ", "it", " ", 
     "is", " ", "an", " ", "acceptable", " ", "Sigma", " ", "matrix", 
     "\[IndentingNewLine]", "These", " ", "values", " ", "are", " ", "based", 
     " ", "on", " ", "the", " ", "statistics", " ", "of", " ", "the", " ", 
     "Sigma", " ", "matrices", " ", "from", " ", "our", " ", "real", " ", 
     "data"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenPreSigma", "[", "p_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"diags", ",", "preSig", ",", "Sig", ",", "b", ",", "i"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"diags", "=", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{"RandomVariate", "[", 
           RowBox[{
            RowBox[{"NormalDistribution", "[", 
             RowBox[{"3.22144", ",", "1.97698"}], "]"}], ",", "p"}], "]"}], 
          "/", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"preSig", "=", 
        RowBox[{"UpperTriangularize", "[", 
         RowBox[{
          RowBox[{"RandomVariate", "[", 
           RowBox[{
            RowBox[{"NormalDistribution", "[", "\[InvisibleSpace]", 
             RowBox[{
             "0.479896", ",", 
              "\[InvisibleSpace]\[InvisibleSpace]\[InvisibleSpace]", 
              "0.98371"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"p", ",", "p"}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
       ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Generates", " ", "the", " ", "upper", " ", "triangular", " ", "part",
          " ", "of", " ", "the", " ", "Sigma", " ", "matrix", " ", "which", 
         " ", "will", " ", "be", " ", "transposed", " ", "and", " ", "added", 
         " ", "to", " ", "give", " ", "a", " ", "symmetic", " ", "matrix"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Sig", "=", 
        RowBox[{"diags", "+", "preSig"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Sig", "=", 
        RowBox[{"Sig", "+", 
         RowBox[{"Transpose", "[", "Sig", "]"}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "Sigma", " ", "matrices", " ", "until", " ", "an", " ", 
     "acceptable", " ", "Sigma", " ", "matrix", " ", "is", " ", "produced"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenSigma", "[", "p_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "Sig", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Sig", "=", 
        RowBox[{"GenPreSigma", "[", "p", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"PositiveSemidefiniteMatrixQ", "[", "Sig", "]"}], "]"}], 
         ",", 
         RowBox[{"Sig", "=", 
          RowBox[{"GenPreSigma", "[", "p", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "Sig"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "data", " ", "without", " ", "specifying", " ", "C", " ",
      "or", " ", "A", " ", "with", " ", "different", " ", "noise", " ", "for",
      " ", "each", " ", "tank"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenData", "[", 
     RowBox[{"B_", ",", "Sig_", ",", "tanks_", ",", "time_", ",", 
      RowBox[{"fudge_:", "10"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "b", ",", "p", ",", "noise", ",", "x0", ",", "X0", ",", "X", ",", "mn",
         ",", "j", ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b", "=", 
        RowBox[{"Transpose", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mn", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "p"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"X", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", "tanks"}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"noise", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"MultinormalDistribution", "[", 
              RowBox[{"mn", ",", "Sig"}], "]"}], ",", 
             RowBox[{"time", "+", "fudge", "+", "1"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"x0", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"UniformDistribution", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "p"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"{", "x0", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"t", "=", "1"}], ",", 
            RowBox[{"t", "\[LessEqual]", 
             RowBox[{"time", "+", "fudge"}]}], ",", 
            RowBox[{"t", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{
               RowBox[{"x0", ".", "b"}], "+", 
               RowBox[{"noise", "[", 
                RowBox[{"[", "t", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X0", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X0", ",", 
                RowBox[{"{", "x0", "}"}]}], "]"}]}]}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"X0", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", "i", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "fudge"}], "}"}]}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"X", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"X", ",", 
             RowBox[{"{", "X0", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "X"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "data", " ", "without", " ", "C", " ", "with", " ", 
     "the", " ", "same", " ", "exact", " ", "noise", " ", "for", " ", "each", 
     " ", "tank"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenDataConsistent", "[", 
     RowBox[{"B_", ",", "Sig_", ",", "tanks_", ",", "time_", ",", 
      RowBox[{"fudge_:", "10"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "b", ",", "p", ",", "noise", ",", "x0", ",", "X0", ",", "X", ",", "mn",
         ",", "j", ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b", "=", 
        RowBox[{"Transpose", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mn", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "p"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"X", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"noise", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"MultinormalDistribution", "[", 
           RowBox[{"mn", ",", "Sig"}], "]"}], ",", 
          RowBox[{"time", "+", "fudge", "+", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", "tanks"}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"x0", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"UniformDistribution", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "p"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"{", "x0", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"t", "=", "1"}], ",", 
            RowBox[{"t", "\[LessEqual]", 
             RowBox[{"time", "+", "fudge"}]}], ",", 
            RowBox[{"t", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{
               RowBox[{"x0", ".", "b"}], "+", 
               RowBox[{"noise", "[", 
                RowBox[{"[", "t", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X0", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X0", ",", 
                RowBox[{"{", "x0", "}"}]}], "]"}]}]}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"X0", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", "i", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "fudge"}], "}"}]}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"X", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"X", ",", 
             RowBox[{"{", "X0", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "X"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "data", " ", "with", " ", "C", " ", "with", " ", "the", 
     " ", "same", " ", "exact", " ", "noise", " ", "for", " ", "each", " ", 
     "tank"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenDataWithC", "[", 
     RowBox[{
     "B_", ",", "Cmat_", ",", "Sig_", ",", "tanks_", ",", "time_", ",", 
      RowBox[{"fudge_:", "10"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "b", ",", "d", ",", "p", ",", "noise", ",", "x0", ",", "X0", ",", "XC",
         ",", "XC0", ",", "U", ",", "U0", ",", "mn", ",", "j", ",", "t"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "Cmat", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b", "=", 
        RowBox[{"Transpose", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mn", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "p"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"XC", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"noise", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"MultinormalDistribution", "[", 
           RowBox[{"mn", ",", "Sig"}], "]"}], ",", 
          RowBox[{"time", "+", "fudge"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", "tanks"}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"U", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"NormalDistribution", "[", 
              RowBox[{"0", ",", "0.2"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"d", ",", 
               RowBox[{"time", "+", "fudge", "+", "1"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"x0", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"UniformDistribution", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "p"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"{", "x0", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"t", "=", "1"}], ",", 
            RowBox[{"t", "\[LessEqual]", 
             RowBox[{"time", "+", "fudge"}]}], ",", 
            RowBox[{"t", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{
               RowBox[{"x0", ".", "b"}], "+", 
               RowBox[{"noise", "[", 
                RowBox[{"[", "t", "]"}], "]"}], "+", 
               RowBox[{"Cmat", ".", 
                RowBox[{"U", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "t"}], "]"}], "]"}]}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X0", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X0", ",", 
                RowBox[{"{", "x0", "}"}]}], "]"}]}]}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"X0", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", "i", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "fudge"}], "}"}]}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"U0", "=", 
           RowBox[{"U", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{
               RowBox[{"fudge", "+", "1"}], ";;", 
               RowBox[{"fudge", "+", "time", "+", "1"}]}]}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"XC0", "=", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", "U0", "]"}], ",", "X0", ",", "2"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"XC", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"XC", ",", 
             RowBox[{"{", "XC0", "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "XC"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "data", " ", "with", " ", "C", " ", "with", " ", "the", 
     " ", "similar", " ", "noise", " ", "for", " ", "each", " ", "tank", " ", 
     "by", " ", "adding", " ", "additional", " ", "random", " ", "noise", " ",
      "in", " ", "with", " ", 
     RowBox[{"1", "/", "10"}], " ", "of", " ", "the", " ", "typical", " ", 
     RowBox[{"variance", "/", "covariance"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenDataWithCNoisy", "[", 
     RowBox[{
     "B_", ",", "Cmat_", ",", "Sig_", ",", "tanks_", ",", "time_", ",", 
      RowBox[{"fudge_:", "10"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "b", ",", "d", ",", "p", ",", "noise", ",", "extranoise", ",", "x0", 
        ",", "X0", ",", "XC", ",", "U", ",", "U0", ",", "XC0", ",", "mn", ",",
         "j", ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Length", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "Cmat", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b", "=", 
        RowBox[{"Transpose", "[", "B", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mn", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "p"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"XC", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"noise", "=", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"MultinormalDistribution", "[", 
           RowBox[{"mn", ",", "Sig"}], "]"}], ",", 
          RowBox[{"time", "+", "fudge"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", "tanks"}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"extranoise", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"MultinormalDistribution", "[", 
              RowBox[{"mn", ",", 
               RowBox[{"0.1", "Sig"}]}], "]"}], ",", 
             RowBox[{"time", "+", "fudge"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"U", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"NormalDistribution", "[", 
              RowBox[{"0", ",", "0.2"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"d", ",", 
               RowBox[{"time", "+", "fudge", "+", "1"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"x0", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{
             RowBox[{"UniformDistribution", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], ",", "p"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"{", "x0", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"t", "=", "1"}], ",", 
            RowBox[{"t", "\[LessEqual]", 
             RowBox[{"time", "+", "fudge"}]}], ",", 
            RowBox[{"t", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"x0", "=", 
              RowBox[{
               RowBox[{"x0", ".", "b"}], "+", 
               RowBox[{"noise", "[", 
                RowBox[{"[", "t", "]"}], "]"}], "+", 
               RowBox[{"extranoise", "[", 
                RowBox[{"[", "t", "]"}], "]"}], "+", 
               RowBox[{"Cmat", ".", 
                RowBox[{"U", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "t"}], "]"}], "]"}]}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"X0", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"X0", ",", 
                RowBox[{"{", "x0", "}"}]}], "]"}]}]}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"X0", "=", 
           RowBox[{"Delete", "[", 
            RowBox[{"X0", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", "i", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "fudge"}], "}"}]}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"U0", "=", 
           RowBox[{"U", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", 
              RowBox[{
               RowBox[{"fudge", "+", "1"}], ";;", 
               RowBox[{"fudge", "+", "time", "+", "1"}]}]}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"XC0", "=", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", "U0", "]"}], ",", "X0", ",", "2"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"XC", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"XC", ",", 
             RowBox[{"{", "XC0", "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "XC"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "B", " ", "matrices", " ", "until", " ", "a", " ", "B", 
     " ", "matrix", " ", "with", " ", "dominant", " ", "eigenvalue", " ", 
     "in", " ", "the", " ", "correct", " ", "range", " ", "is", " ", 
     "produced"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GenBNewrange", "[", 
     RowBox[{"p_", ",", "min_", ",", "max_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"B", ",", "eig"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"B", "=", 
        RowBox[{"GenPreBNew", "[", "p", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eig", "=", 
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", 
          RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"eig", ">", "max"}], "||", 
          RowBox[{"eig", "<", "min"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"B", "=", 
           RowBox[{"GenPreBNew", "[", "p", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"eig", "=", 
           RowBox[{"Max", "[", 
            RowBox[{"Abs", "[", 
             RowBox[{"Eigenvalues", "[", "B", "]"}], "]"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "B"}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.659383659013154*^9, 3.659383661405739*^9}, {
   3.65938369454792*^9, 3.6593837619531126`*^9}, {3.6593838045718565`*^9, 
   3.6593839511398773`*^9}, {3.6593840124888973`*^9, 3.659384065343875*^9}, {
   3.659384133949938*^9, 3.6593842042008924`*^9}, {3.6593842599286084`*^9, 
   3.6593842842107053`*^9}, {3.6593848731043606`*^9, 
   3.6593849080732965`*^9}, {3.659387660685196*^9, 3.6593876607282224`*^9}, {
   3.659451934312849*^9, 3.6594519347991724`*^9}, {3.659473270384823*^9, 
   3.659473270715041*^9}, {3.659473311180021*^9, 3.659473329395117*^9}, {
   3.6594735749520593`*^9, 3.659473585068605*^9}, {3.672658972354869*^9, 
   3.67265902667419*^9}, 3.672659081102024*^9, {3.6744831752990437`*^9, 
   3.674483182873925*^9}, {3.6744834608161583`*^9, 3.674483526044601*^9}, {
   3.6744836387388163`*^9, 3.6744836562904863`*^9}, {3.6744836888448687`*^9, 
   3.674483713392598*^9}, {3.674483744821824*^9, 3.674483747755149*^9}, {
   3.674483803400696*^9, 3.674483897922373*^9}, {3.674485633446135*^9, 
   3.6744856715960703`*^9}, {3.6748149386412153`*^9, 3.674814938973712*^9}, {
   3.674815030847999*^9, 3.674815099160344*^9}, {3.674815214913253*^9, 
   3.674815260773946*^9}, {3.674815306263303*^9, 3.674815352826915*^9}, {
   3.674815632228469*^9, 3.674815632539466*^9}, {3.674816531121809*^9, 
   3.674816559233119*^9}, {3.674816741090805*^9, 3.6748167503831863`*^9}, 
   3.674816919591902*^9, {3.674817247015417*^9, 3.674817275792151*^9}, {
   3.6748173640430517`*^9, 3.674817373109243*^9}, {3.674817425831999*^9, 
   3.6748174974615307`*^9}, {3.675511177048459*^9, 3.675511177606393*^9}, {
   3.675524202545537*^9, 3.675524225521853*^9}, {3.675598434601795*^9, 
   3.675598435065593*^9}, {3.6755984780390453`*^9, 3.675598478727438*^9}, {
   3.675598519889324*^9, 3.6755986268731213`*^9}, 3.6755986600511827`*^9, {
   3.6755986953968353`*^9, 3.6755987071960783`*^9}, {3.675599460399137*^9, 
   3.675599463301103*^9}, {3.675604827866933*^9, 3.675604835932482*^9}, {
   3.6756048741828203`*^9, 3.6756048755459146`*^9}, {3.675605641636849*^9, 
   3.675605675190298*^9}, {3.675606146131411*^9, 3.6756061801869497`*^9}, {
   3.6756062933429937`*^9, 3.675606305563469*^9}, 3.67560721000428*^9, {
   3.675678525927123*^9, 3.6756785291802063`*^9}, {3.67567856075733*^9, 
   3.67567859652717*^9}, {3.675678803359352*^9, 3.675678807453519*^9}, {
   3.675679866497985*^9, 3.675679878112617*^9}, {3.675680167608082*^9, 
   3.675680180675963*^9}, {3.675680595527256*^9, 3.675680694373073*^9}, {
   3.67568081607699*^9, 3.675680954392044*^9}, {3.675681239828783*^9, 
   3.675681299799623*^9}, {3.675688940721931*^9, 3.675688952622465*^9}, {
   3.6756890158762836`*^9, 3.675689064708482*^9}, {3.67568909666084*^9, 
   3.6756891335747433`*^9}, {3.6756892138764772`*^9, 3.675689225113406*^9}, {
   3.675689862383313*^9, 3.675689897599317*^9}, {3.675690047267973*^9, 
   3.6756900518269453`*^9}, 3.6757776771108418`*^9, 3.6757779653080378`*^9, {
   3.675778271202817*^9, 3.675778272806411*^9}, 3.6757790346724033`*^9, {
   3.675780747908877*^9, 3.675780823657357*^9}, {3.675780960862928*^9, 
   3.675780999636961*^9}, {3.675781057717313*^9, 3.6757810675448513`*^9}, {
   3.67578113018388*^9, 3.675781160137306*^9}, {3.6757811904924583`*^9, 
   3.675781221927269*^9}, {3.675781259300474*^9, 3.675781333513546*^9}, {
   3.6757816146312513`*^9, 3.6757816403603992`*^9}, {3.6757816845892467`*^9, 
   3.67578170833757*^9}, {3.675781746668872*^9, 3.6757817520207567`*^9}, {
   3.675782943975505*^9, 3.675782944125938*^9}, {3.675783034252688*^9, 
   3.675783036262443*^9}, {3.675783365125575*^9, 3.675783365444193*^9}, {
   3.675783734821794*^9, 3.675783762865419*^9}, 3.675785983526325*^9, {
   3.675786069991666*^9, 3.675786070091463*^9}, {3.675786116862492*^9, 
   3.675786117330448*^9}, 3.675786906415386*^9, 3.675787025710546*^9, {
   3.675984631558846*^9, 3.67598466928022*^9}, {3.675984702045082*^9, 
   3.675984751760478*^9}, {3.675984783429743*^9, 3.675984802080048*^9}, {
   3.676023525752924*^9, 3.676023549552046*^9}, {3.676026897422762*^9, 
   3.676026899001766*^9}, {3.676026965155245*^9, 3.676026979457038*^9}, {
   3.676027013944015*^9, 3.6760270235031652`*^9}, {3.67602706705158*^9, 
   3.676027175652066*^9}, {3.676027252478611*^9, 3.6760273733620663`*^9}, {
   3.6760274039882727`*^9, 3.6760275357133427`*^9}, 3.676029665068264*^9, {
   3.676029967234476*^9, 3.6760299673088427`*^9}, {3.676030125975371*^9, 
   3.676030126418624*^9}, 3.676042443351939*^9, {3.676043232901204*^9, 
   3.6760432401770782`*^9}, {3.67604327245632*^9, 3.676043276371393*^9}, {
   3.676109184690037*^9, 3.676109202409686*^9}, {3.6761093654628143`*^9, 
   3.67610937990525*^9}, 3.6762898617014*^9, {3.6763013594651623`*^9, 
   3.6763014050416927`*^9}, {3.676301753620447*^9, 3.676302003947571*^9}, {
   3.676302062157361*^9, 3.676302177985867*^9}, {3.676302243931725*^9, 
   3.6763025271019907`*^9}, {3.676302593672427*^9, 3.676302618749271*^9}, {
   3.676369481973497*^9, 3.676369681633408*^9}, {3.67672138491883*^9, 
   3.676721393038396*^9}, {3.676721472214796*^9, 3.676721483002549*^9}, {
   3.676933064290914*^9, 3.676933076457162*^9}, {3.6769742819843082`*^9, 
   3.67697428702488*^9}, {3.6769743985180597`*^9, 3.67697440329291*^9}, {
   3.6769859973028708`*^9, 3.676985997820496*^9}, 3.6769886163219233`*^9, {
   3.6771886472768507`*^9, 3.67718870747619*^9}, {3.6771890501692677`*^9, 
   3.6771890683017197`*^9}, {3.677189110024283*^9, 3.677189158732648*^9}, {
   3.677189399878327*^9, 3.677189404245154*^9}, 3.677189470056892*^9, {
   3.677189501847783*^9, 3.6771895133131733`*^9}, {3.677189546167507*^9, 
   3.67718954904663*^9}}],

Cell[BoxData[
 RowBox[{"Print", "[", "\"\<MAR_functions evaluation complete!\>\"", 
  "]"}]], "Input",
 CellChangeTimes->{{3.6593845775857706`*^9, 3.6593845961324863`*^9}}]
},
WindowSize->{870, 787},
WindowMargins->{{-1, Automatic}, {Automatic, 0}},
FrontEndVersion->"10.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (December 10, \
2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 109974, 2606, 10062, "Input"],
Cell[110535, 2628, 172, 3, 28, "Input"]
}
]
*)

(* End of internal cache information *)
